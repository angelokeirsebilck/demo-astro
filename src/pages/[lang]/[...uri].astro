---
import DefaultLayout from "@layouts/DefaultLayout.astro"
import { useGraphqlQuery } from "@composables/useGraphqlQuery"
import { entryQuery } from "@graphql/entry.gql.js"
import { categoryQuery } from "@graphql/category.gql"
import { GetSiteIdFromLang } from "@composables/useGetSiteIdFromLang"

const { searchParams } = Astro.url
const { lang, uri } = Astro.params

const parsedUri = uri ? uri : "__home__"

let content

const {
  data: { entry },
} = await useGraphqlQuery({
  query: entryQuery,
  routeQuery: Object.fromEntries(searchParams),
  variables: {
    siteId: GetSiteIdFromLang({ lang }),
    uri: parsedUri.toString(),
  },
})

content = entry

if (!entry) {
  const {
    data: { category },
  } = await useGraphqlQuery({
    query: categoryQuery,
    routeQuery: Object.fromEntries(searchParams),
    variables: {
      siteId: GetSiteIdFromLang({ lang }),
      uri: parsedUri.toString(),
    },
  })

  content = category
}
---

<DefaultLayout
  title={content.title}
  id={content.id}
  siteId={content.siteId}
  sectionHandle={content.sectionHandle}
  typeHandle={content.typeHandle}
  lang={content.language}
  uri={content.uri}
  slug={content.slug}
  groupHandle={content.groupHandle}
/>
